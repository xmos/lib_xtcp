VERSION = 4.0.1

DEPENDENT_MODULES = lib_ethernet(>=3.0.3) lib_otpinfo(>=2.0.0) lib_crypto

ifeq ($(CONFIG),IPV6)
XTCP_SOURCE_DIRS = src src/xtcp_uip6/*
EXCLUDE_FILES += uip_arp.c autoip.c dhcp.c igmp.c rpl.c rpl-dag.c rpl-ext-header.c \
                 rpl-icmp6.c rpl-mrhof.c rpl-of0.c rpl-timers.c

else
LWIP_SOURCE_DIRS = src/xtcp_lwip/api src/xtcp_lwip/core/ src/xtcp_lwip/core/ipv4 src/xtcp_lwip/netif src/xtcp_lwip/xcore/src
MBEDTLS_SOURCE_DIRS = src/xtcp_mbedtls/library
XTCP_SOURCE_DIRS = src src/xtcp_uip/*
EXCLUDE_FILES += uip-fw.c uip-neighbor.c
endif

SOURCE_DIRS += $(XTCP_SOURCE_DIRS)

LWIP_INCLUDE_DIRS = src/xtcp_lwip/include src/xtcp_lwip/xcore/include
MBEDTLS_INCLUDE_DIRS = src/xtcp_mbedtls/include
INCLUDE_DIRS += $(XTCP_SOURCE_DIRS) api
OPTIONAL_HEADERS += xtcp_client_conf.h xtcp_conf.h
MODULE_XCC_FLAGS = $(XCC_FLAGS)
MODULE_XCC_C_FLAGS = $(XCC_C_FLAGS) -Wno-ignored-attributes -Wno-typedef-redefinition -DUNSAFE_LIBC -Os
MODULE_XCC_XC_FLAGS = $(XCC_XC_FLAGS) -DUNSAFE_LIBC -Os

# $(call SET_XCC_XC_FLAGS, $(XTCP_SOURCE_DIRS), $(XCC_XC_FLAGS) -g -Os)
# $(call SET_XCC_C_FLAGS, $(XTCP_SOURCE_DIRS), $(XCC_C_FLAGS) -Os)

XCC_FLAGS_xcoredev.xc = $(XCC_XC_FLAGS) -fsubword-select
XCC_FLAGS_xtcp_server.xc = $(XCC_XC_FLAGS) -fsubword-select
XCC_FLAGS_uip_xtcp_support.xc = $(XCC_XC_FLAGS) -fsubword-select

XCC_FLAGS_uip_single_server.xc = $(XCC_XC_FLAGS) -fsubword-select

XCC_FLAGS_uip_xtcp.xc = $(XCC_XC_FLAGS) -Wno-parentheses-equality

ifeq ($(LWIP_XTCP),1)
EXCLUDE_FILES += uip_xtcp.c xcoredev.xc uip_server_support.c xtcp.xc dhcpc.c autoip/autoip.c uip-split.c uip_arp.c uip.c psock.c
SOURCE_DIRS += $(LWIP_SOURCE_DIRS) $(MBEDTLS_SOURCE_DIRS)
INCLUDE_DIRS += $(LWIP_INCLUDE_DIRS) $(MBEDTLS_INCLUDE_DIRS)
else
EXCLUDE_FILES += xtcp_lwip.xc
endif

#  Uncomment for debugging
#  $(warning ****Building parts of xtcp at -O0 to help debugging****** )
#  XCC_FLAGS_uip_xtcp.c = $(XCC_FLAGS) -O0 -g
#  XCC_FLAGS_uip.c = $(XCC_FLAGS) -O0 -g

